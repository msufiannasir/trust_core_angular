<nb-card>
  <nb-card-header> 
    <button nbButton status="primary" class="appearance-filled size-medium shape-rectangle status-basic nb-transition" *ngIf="collectionHandle=='offers'" (click)="goBack()">‚Üê Back</button>
    <h1 style="text-transform: capitalize;">{{ collectionHandle }}</h1>
    <button *ngIf="showBlueprintButton" nbButton status="primary" (click)="navigateToBlueprint()" class="appearance-filled size-medium shape-rectangle status-basic nb-transition">
      Edit Blueprint
    </button>
  </nb-card-header>
  <nb-card-body>
    <form #entryForm="ngForm" (ngSubmit)="onSubmit(entryForm)" novalidate>
      <div class="row "> 
        <ng-container *ngFor="let field of metaArray; let i = index">
          <div class="col-md-6" *ngIf="!isHidden(field.key)">
            <div class="form-group">
              <label [for]="field.key" class="label">
                {{ field.displayKey | titlecase }}
                <span *ngIf="isRequiredField(field.key)" class="text-danger">*</span> <!-- Show * if required -->
              </label>

              <!-- Text Input -->
              <input *ngIf="isTextField(field.key)"
                type="text"
                class="w-100 form-control"
                [id]="field.key"
                [name]="field.key"
                [placeholder]="'Enter ' + field.displayKey | titlecase"
                [(ngModel)]="field.value"
                #fieldModel="ngModel"
                (blur)="captureFieldValue($event.target.value, i)"
                [ngModelOptions]="{ updateOn: 'blur' }"
                [ngClass]="{'error-border': validationErrors[field.key]}" 
                [required]="isRequiredField(field.key)"
              />
              <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
                This field is required.
              </div>
    
              <!-- Textarea -->
              <textarea *ngIf="isTextareaField(field.key)"
                class="w-100 form-control"
                [id]="field.key"
                [name]="field.key"
                [placeholder]="'Enter ' + field.displayKey | titlecase"
                [(ngModel)]="field.value"
                #fieldModel="ngModel"
                (blur)="captureFieldValue($event.target.value, i)"
                [ngModelOptions]="{ updateOn: 'blur' }"
                [ngClass]="{'error-border': validationErrors[field.key]}" 
                [required]="isRequiredField(field.key)"
                >
              </textarea>
              <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
                This field is required.
              </div>
    
              <div *ngIf="isFileField(field.key)" class="form-group">
                <input
                  type="file"
                  class="form-control"
                  [id]="field.key"
                  [name]="field.key"
                  (change)="handleFileUpload($event, field.key, i)"
                  [ngClass]="{'error-border': validationErrors[field.key]}"
                  [required]="isRequiredField(field.key)" />
              </div>
              <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
                This field is required.
              </div>
    

              <!-- Dropdown Select -->
              <select
              *ngIf="isDropdownField(field.key)"
              class="form-control"
              [(ngModel)]="field.value"
              (ngModelChange)="onDropdownChange(field.key, $event)"
              [name]="field.key"
              #fieldModel="ngModel"
              [ngModelOptions]="{ updateOn: 'blur' }"
              [ngClass]="{'error-border': validationErrors[field.key]}" 
              [required]="isRequiredField(field.key)"
            >
              <option value="">Select an option</option>
              <option *ngFor="let option of field.allOptions" [value]="option.id" [selected]="option.id === field.value">
                {{ option.display }}
              </option>
            </select>
            <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
              This field is required.
            </div>
            

              <!-- Date Input -->
              <input *ngIf="isDateField(field.key)"
              type="date"
              class="form-control"
              [(ngModel)]="field.value"
              [name]="field.key"
              #fieldModel="ngModel"
              (ngModelChange)="captureFieldValue($event, i)"
              [ngClass]="{'error-border': validationErrors[field.key]}" 
              [ngModelOptions]="{ updateOn: 'blur' }"
              [required]="isRequiredField(field.key)">
              <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
                This field is required.
              </div>
            
              <!-- Default Text Input (fallback for unknown fields) -->
              <input *ngIf="!isTextField(field.key) && !isTextareaField(field.key) && !isFileField(field.key) && !isDropdownField(field.key) && !isDateField(field.key)"
                type="text"
                class="w-100 form-control"
                [id]="field.key"
                [name]="field.key"
                [placeholder]="'Enter ' + field.displayKey | titlecase"
                [(ngModel)]="field.value"
                [ngClass]="{'error-border': validationErrors[field.key]}" 
                #fieldModel="ngModel"
                [ngModelOptions]="{ updateOn: 'blur' }"
                [required]="isRequiredField(field.key)"
              />
              <div *ngIf="fieldModel?.invalid && fieldModel?.touched" class="text-danger">
                This field is required.
              </div>
    
            </div>
          </div>
        </ng-container>
      </div>

      <button
        type="button"
        nbButton
        status="success"
        class="appearance-filled size-medium shape-rectangle status-basic nb-transition mt-3"
        (click)="onSubmit($event, false)"
      >
        {{ collectionHandle!='offers' ? 'Submit' : 'Next' }}
      </button>
              <!-- Submit & Redirect Button -->
              <button
              *ngIf="showRedirectButton"
              type="button"
              nbButton
              status="primary"
              class="appearance-filled size-medium shape-rectangle status-basic nb-transition mt-3 ml-2"
              (click)="onSubmit($event, true)"
            >
              Submit and GO
            </button>
    </form>
  </nb-card-body>
</nb-card>
